---
// TODO: MAKE MOBILE RESPONSIVE

import { Image } from "astro:assets";
import BaseLayout from "../layouts/BaseLayout.astro";

const res = await fetch(
  "https://emilyoot-com.vercel.app/api/getStripeProducts",
);
const json = await res.json();
const products = [];
for (const product of json.data) {
  const id = product.id;
  const name = product.name;
  const image = product.images[0];
  const price = 1; // TODO
  if (name && image && price) {
    products.push({
      id,
      name,
      image,
      price,
    });
  }
}
---

<style>
  .products {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    width: 1140px;
    max-width: 100%;
  }

  a.product {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding-left: 10px;
    padding-right: 10px;
    padding-bottom: 20px;
    max-width: calc(33% - 20px);
    transition: filter 300ms;
    text-decoration: none;
    color: #7a7a7a;
  }

  .product:hover {
    filter: brightness(0.8);
  }

  .image {
    max-height: 500px;
    max-width: 100%;
    width: auto;
    height: auto;
    object-fit: contain;
  }

  .name {
    font-size: 16px;
    margin-top: 5px;
  }

  .price {
    font-size: 16px;
    margin-top: 5px;
  }
</style>

<BaseLayout>
  <div class="products">
    {
      products.map((product) => {
        const prettyPrice = product.price.toLocaleString("en-US", {
          style: "currency",
          currency: "USD",
        });
        return (
          <a href={`/shop/${product.id}`} class="product">
            <Image
              class="image"
              src={product.image}
              alt={`${product.name} by Emily Oot`}
              inferSize
            />
            <div class="name">{product.name}</div>
            <div class="price">{prettyPrice}</div>
          </a>
        );
      })
    }
  </div>
</BaseLayout>
