---
import { Icon } from "astro-icon/components";
import { Image } from "astro:assets";
import BaseLayout from "../../layouts/BaseLayout.astro";

export async function getStaticPaths() {
  const res = await fetch(
    "https://emilyoot-com.vercel.app/api/getStripeProducts",
  );
  const json = await res.json();
  const products = [];
  for (const product of json.data) {
    const id = product.id;
    const name = product.name;
    const image = product.images[0];
    const price = 1; // TODO
    if (name && image && price && id) {
      products.push({
        id,
        name,
        image,
        price,
      });
    }
  }
  return products.map((product) => {
    return {
      params: {
        slug: product.id,
      },
      props: {
        product,
      },
    };
  });
}

const { product } = Astro.props;

const prettyPrice = product.price.toLocaleString("en-US", {
  style: "currency",
  currency: "USD",
});
---

<style>
  .content {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    width: 700px;
    max-width: 100%;
  }

  a.back {
    display: flex;
    align-items: center;
    text-decoration: none;
    color: #7a7a7a;
    line-height: 1;
    font-size: 16px;
    transition: 200ms all;
  }

  a.back:hover {
    filter: brightness(0.8);
    text-decoration: underline;
  }

  .icon {
    transform: rotate(180deg);
    margin-right: 5px;
  }

  .product {
    padding: 40px 0;
    display: flex;
    flex-wrap: wrap;
  }

  .image {
    width: calc(50% - 20px);
    padding-right: 20px;
    padding-bottom: 20px;
    height: auto;
  }

  .name {
    font-size: 18px;
    color: #252525;
    margin-bottom: 10px;
  }

  .price {
    font-size: 16px;
    margin-bottom: 10px;
    color: #252525;
  }
</style>

<BaseLayout>
  <div class="content">
    <a href="/shop" class="back">
      <Icon
        class="icon"
        name="hugeicons:arrow-right-01"
        width="20"
        height="20"
      />
      <div>Back to shop</div>
    </a>
    <div class="product">
      <Image
        class="image"
        src={product.image}
        alt={`${product.name} by Emily Oot`}
        inferSize
      />
      <div class="details">
        <div class="name">{product.name}</div>
        <div class="price">{prettyPrice} USD</div>
        <div class="price">Shipping costs will be calculated at checkout.</div>
      </div>
    </div>
  </div>
</BaseLayout>
